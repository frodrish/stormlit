---
import AgGridWrapper from './AgGridWrapper.jsx';
import {insertQuery} from './db.js';
import crypto from 'crypto';

import {cacheDir, outDir} from "astro:config/server";

let slotContent = '';
if (Astro.slots.has('default')) {
    slotContent = await Astro.slots.render('default');
}

console.log(slotContent);

// Only use rowData from props
let { rowData } = Astro.props;
if (!Array.isArray(rowData)) {
  rowData = [];
}

const columnDefs = rowData.length > 0
  ? Object.keys(rowData[0]).map(key => ({
      headerName: key.charAt(0).toUpperCase() + key.slice(1),
      field: key,
      sortable: true,
      filter: true,
    }))
  : [];


const sql = slotContent.toString();
const id = crypto.createHash('md5').update(sql).digest('hex');


const data = insertQuery('my.db',id, sql)
console.error("data:",data);

const url = `/data?id=${id}`;
---

<AgGridWrapper client:only="react" url={url} columnDefs={columnDefs}/>
